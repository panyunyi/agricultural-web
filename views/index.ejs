<%include header%>
        <div class="tpl-content-wrapper">
            <div class="tpl-content-page-title">
                璜泾现代农业园数据监测后台
            </div>
            <ol class="am-breadcrumb">
                <li><a href="#" class="am-icon-home">首页</a></li>
                <li><a href="#">分类</a></li>
                <li class="am-active">内容</li>
            </ol>
            <div class="tpl-content-scope">
                <div class="note note-info">
                    <h3>璜泾现代农业园物联网
                        <span class="close" data-close="note"></span>
                    </h3>
                    <p>璜泾现代农业园是苏州市级农业园，拥有500亩设施蔬菜、2000亩露地蔬菜及万亩良田。</p>
                    <p><span class="label label-danger">提示:</span>十三五规划要求大力发展农业物联网技术，太仓农委也大力支持现代农业园的物联网建设，璜泾镇现代农业园顺应潮流的趋势，必定可以做好农业园现代化物联网建设的领先者。
                    </p>
                </div>
            </div>

            <div class="row">
                <div class="am-u-lg-3 am-u-md-6 am-u-sm-12">
                    <div class="dashboard-stat blue">
                        <div class="visual">
                            <i class="am-icon-comments-o"></i>
                        </div>
                        <div class="details">
                            <div class="number"> 1349 </div>
                            <div class="desc"> 作物信息 </div>
                        </div>
                        <a class="more" href="#"> 查看更多
                    <i class="m-icon-swapright m-icon-white"></i>
                </a>
                    </div>
                </div>
                <div class="am-u-lg-3 am-u-md-6 am-u-sm-12">
                    <div class="dashboard-stat red">
                        <div class="visual">
                            <i class="am-icon-bar-chart-o"></i>
                        </div>
                        <div class="details">
                            <div class="number"> 62% </div>
                            <div class="desc"> 收产率 </div>
                        </div>
                        <a class="more" href="#"> 查看更多
                    <i class="m-icon-swapright m-icon-white"></i>
                </a>
                    </div>
                </div>
                <div class="am-u-lg-3 am-u-md-6 am-u-sm-12">
                    <div class="dashboard-stat green">
                        <div class="visual">
                            <i class="am-icon-apple"></i>
                        </div>
                        <div class="details">
                            <div class="number"> 653 </div>
                            <div class="desc"> 农事记录 </div>
                        </div>
                        <a class="more" href="#"> 查看更多
                    <i class="m-icon-swapright m-icon-white"></i>
                </a>
                    </div>
                </div>
                <div class="am-u-lg-3 am-u-md-6 am-u-sm-12">
                    <div class="dashboard-stat purple">
                        <div class="visual">
                            <i class="am-icon-android"></i>
                        </div>
                        <div class="details">
                            <div class="number"> 786 </div>
                            <div class="desc"> 绿色履历 </div>
                        </div>
                        <a class="more" href="#"> 查看更多
                    <i class="m-icon-swapright m-icon-white"></i>
                </a>
                    </div>
                </div>



            </div>

            <div class="row">
                <div class="am-u-md-6 am-u-sm-12 row-mb">
                    <div class="tpl-portlet">
                        <div class="tpl-portlet-title">
                            <div class="tpl-caption font-green ">
                                <i class="am-icon-cloud-download"></i>
                                <span> Cloud 环境动态信息</span>
                            </div>
                        </div>
                        <div class="tpl-scrollable">
                            <div class="number-stats">
                                <div class="stat-number am-fl am-u-md-8">
                                    <div class="number am-text-right am-text-warning"> 草莓大棚 </div>
                                </div>
                            </div>

                            <table class="am-table tpl-table">
                                <thead>
                                    <tr class="tpl-table-uppercase">
                                        <th>传感器</th>
                                        <th>数值</th>
                                        <th>告警阀值</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td class="user-name"><i class="fa-thermometer font-red"></i>室内温度</td>
                                        <td class="font-green bold" id="temp2"></td>
                                        <td class="font-red bold" id="war-temp2">100~0</td>
                                    </tr>
                                    <tr>
                                        <td class="user-name"><i class="am-icon-tint font-green"></i>室内湿度</td>
                                        <td class="font-green bold" id="wet2"></td>
                                        <td class="font-red bold" id="war-wet2">100~0</td>
                                    </tr>
                                    <tr>
                                        <td class="user-name"><i class="am-icon-circle-thin font-green"></i>二氧化碳浓度</td>
                                        <td class="font-green bold" id="co22"></td>
                                        <td class="font-red bold" id="war-co22">100~0</td>
                                    </tr>
                                    <tr>
                                        <td class="user-name"><i class="am-icon-eyedropper font-green"></i>土壤PH值</td>
                                        <td class="font-green bold" id="ph2"></td>
                                        <td class="font-red bold" id="war-ph2">14~0</td>
                                    </tr>
                                    <tr>
                                        <td class="user-name"><i class="am-icon-sun-o am-text-warning"></i>光照度</td>
                                        <td class="font-green bold" id="light2"></td>
                                        <td class="font-red bold" id="war-light2">20000~0</td>
                                    </tr>
                                    <tr>
                                        <td class="user-name"><i class="am-icon-tint font-green"></i>土壤湿度</td>
                                        <td class="font-green bold" id="soild2"></td>
                                        <td class="font-red bold" id="war-soild2">99~0</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="am-u-md-6 am-u-sm-12 row-mb">
                    <div class="tpl-portlet">
                        <div class="tpl-portlet-title">
                            <div class="tpl-caption font-red ">
                                <i class="am-icon-bar-chart"></i>
                                <span> Cloud 环境动态信息</span>
                            </div>
                        </div>
                        <div class="tpl-scrollable">
                            <div class="number-stats">
                                <div class="stat-number am-fl am-u-md-8">
                                    <div class="number am-text-right am-text-success"> 蔬菜大棚 </div>
                                </div>
                            </div>

                            <table class="am-table tpl-table">
                                <thead>
                                    <tr class="tpl-table-uppercase">
                                        <th>传感器</th>
                                        <th>数值</th>
                                        <th>告警阀值</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td class="user-name"><i class="fa-thermometer font-red"></i>室内温度</td>
                                        <td class="font-green bold" id="temp"></td>
                                        <td class="font-red bold" id="war-temp">100~0</td>
                                    </tr>
                                    <tr>
                                        <td class="user-name"><i class="am-icon-tint font-green"></i>室内湿度</td>
                                        <td class="font-green bold" id="wet"></td>
                                        <td class="font-red bold" id="war-wet">100~0</td>
                                    </tr>
                                    <tr>
                                        <td class="user-name"><i class="am-icon-circle-thin font-green"></i>二氧化碳浓度</td>
                                        <td class="font-green bold" id="co2"></td>
                                        <td class="font-red bold" id="war-co2">100~0</td>
                                    </tr>
                                    <tr>
                                        <td class="user-name"><i class="am-icon-eyedropper font-green"></i>土壤PH值</td>
                                        <td class="font-green bold" id="ph"></td>
                                        <td class="font-red bold" id="war-ph">14~0</td>
                                    </tr>
                                    <tr>
                                        <td class="user-name"><i class="am-icon-sun-o am-text-warning"></i>光照度</td>
                                        <td class="font-green bold" id="light"></td>
                                        <td class="font-red bold" id="war-light">20000~0</td>
                                    </tr>
                                    <tr>
                                        <td class="user-name"><i class="am-icon-tint font-green"></i>土壤湿度</td>
                                        <td class="font-green bold" id="soild"></td>
                                        <td class="font-red bold" id="war-soild">99~0</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>


            <div class="row">
                <div class="am-u-md-6 am-u-sm-12 row-mb">
                    <div class="tpl-portlet">
                        <div class="tpl-portlet-title">
                            <div class="tpl-caption font-green ">
                                <i class="am-icon-line-chart"></i>
                                <span> 实时数据监测</span>
                            </div>
                            <div class="actions">
                                <ul class="actions-btn">
                                    <li id="temp-chart" class="red-on">温度</li>

                                </ul>
                            </div>
                        </div>

                        <!--此部分数据请在 js文件夹下中的 app.js 中的 “百度图表A” 处修改数据 插件使用的是 百度echarts-->
                        <div class="tpl-echarts" id="echarts">

                        </div>
                    </div>
                </div>
                <div class="am-u-md-6 am-u-sm-12 row-mb">
                    <div class="tpl-portlet">
                        <div class="tpl-portlet-title">
                            <div class="tpl-caption font-green ">
                                <i id="flag" class="am-icon-calendar-plus-o"></i>
                                <span>农事进度</span>
                            </div>

                        </div>

                        <div class="am-tabs tpl-index-tabs" data-am-tabs>
                            <ul class="am-tabs-nav am-nav am-nav-tabs">
                                <li id="doing" class="am-active"><a href="#tab1">进行中</a></li>
                                <li id="done"><a href="#tab2">已完成</a></li>
                            </ul>

                            <div class="am-tabs-bd">
                                <div class="am-tab-panel am-fade am-in am-active" id="tab1">
                                    <div id="wrapperA" class="wrapper">
                                        <div id="scroller" class="scroller">
                                            <ul class="tpl-task-list tpl-task-remind">
                                                <% for(var i=0; i<data.length; i++) {%>
                                                     <%if(!data[i].get('status')){%>
                                                <li>
                                                    <div class="cosB">
                                                        <%=data[i].get('time')%>
                                                    </div>
                                                    <div class="cosA">
                                                        <span class="cosIco">
                                                            <i class="am-icon-tag"></i>
                                                          </span>
                                                        <span>
                                                            <%=data[i].get('user')%>
                                                            在<%=data[i].get('greenhouse')%>
                                                            给<%=data[i].get('crop')%>
                                                            <%=data[i].get('name')%>
                                                        </span>
                                                    </div>

                                                </li>
                                                <% } }%>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <div class="am-tab-panel am-fade" id="tab2">
                                    <div id="wrapperB" class="wrapper">
                                        <div id="scroller" class="scroller">
                                            <ul class="tpl-task-list tpl-task-remind">
                                                <% for(var i=0; i<data.length; i++) {%>
                                                     <%if(data[i].get('status')){%>
                                                <li>
                                                    <div class="cosB">
                                                        <%=data[i].get('time')%>
                                                    </div>
                                                    <div class="cosA">
                                                        <span class="cosIco">
                                                            <i class="am-icon-tag"></i>
                                                          </span>
                                                        <span>
                                                            <%=data[i].get('user')%>
                                                            在<%=data[i].get('greenhouse')%>
                                                            已给<%=data[i].get('crop')%>
                                                            <%=data[i].get('name')%>
                                                        </span>
                                                    </div>

                                                </li>
                                                <% } }%>
                                            </ul>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>

                    </div>
                </div>
            </div>



        </div>

    </div>


    <script src="../assets/js/jquery.min.js"></script>
    <script src="../assets/js/amazeui.min.js"></script>
    <script src="../assets/js/iscroll.js"></script>
    <script src="../assets/js/app.js"></script>
    <script src="http://cdn.bootcss.com/socket.io/1.7.2/socket.io.min.js"></script>
    <script src="../assets/js/echarts.min.js"></script>
    <script type="text/javascript">
        var tempdata_cm=[];
        var tempdata_sc=[];
        var wetdata_cm=[];
        var wetdata_sc=[];
        var co2data_cm=[];
        var co2data_sc=[];
        var luxdata_cm=[];
        var luxdata_sc=[];
        var soliddata_cm=[];
        var soliddata_sc=[];
        var time=[];
        var hour=[];
        var echartsA = echarts.init(document.getElementById('echarts'));
        var option = {
                title: {
                    text: '大棚温度',
                    subtext: getNowFormatDate().slice(0,10)
                },
                tooltip: {
                    trigger: 'axis'
                },
                legend: {
                    data:['草莓大棚','蔬菜大棚']
                },
                toolbox: {
                    show: true,
                    feature: {
                        dataView: {readOnly: false},
                        magicType: {type: ['line', 'bar']},
                        restore: {},
                        saveAsImage: {}
                    }
                },
                xAxis:  {
                    type: 'category',
                    boundaryGap: false,
                    data: hour
                },
                yAxis: {
                    type: 'value',
                    axisLabel: {
                        formatter: '{value} °C'
                    }
                },
                series: [
                    {
                        name:'草莓大棚',
                        type:'line',
                        data:tempdata_cm,
                        markPoint: {
                            data: [
                                {type: 'max', name: '最大值'},
                                {type: 'min', name: '最小值'}
                            ]
                        },
                        markLine: {
                            data: [
                                {type: 'average', name: '平均值'}
                            ]
                        }
                    },
                    {
                        name:'蔬菜大棚',
                        type:'line',
                        data:tempdata_sc,
                        markPoint: {
                            data: [
                                {name: '周最低', value: -2, xAxis: 1, yAxis: -1.5}
                            ]
                        },
                        markPoint: {
                            data: [
                                {type: 'max', name: '最大值'},
                                {type: 'min', name: '最小值'}
                            ]
                        },
                        markLine: {
                            data: [
                                {type: 'average', name: '平均值'}
                            ]
                        }
                    }
                ]
            };

        function getData(){
            $.get('../api/getInfo',function(result){
                time.splice(0,time.length);
                hour.splice(0,hour.length);
                tempdata_sc.splice(0,tempdata_sc.length);
                tempdata_cm.splice(0,tempdata_cm.length);
                wetdata_sc.splice(0,wetdata_sc.length);
                wetdata_cm.splice(0,wetdata_cm.length);
                co2data_sc.splice(0,co2data_sc.length);
                co2data_cm.splice(0,co2data_cm.length);
                luxdata_sc.splice(0,luxdata_sc.length);
                luxdata_cm.splice(0,luxdata_cm.length);
                soliddata_cm.splice(0,soliddata_cm.length);
                soliddata_sc.splice(0,soliddata_sc.length);
                for(var i=0;i<result.length;i++){
                    var arr1=result[i].info.split(',').slice(0,6);
                    var arr2=result[i].info.split(',').slice(6);
                    tempdata_sc.push(parseFloat(arr1[0]).toFixed(2));
                    tempdata_cm.push(parseFloat(arr2[0]).toFixed(2));
                    wetdata_sc.push(arr1[1]);
                    wetdata_cm.push(arr2[1]);
                    co2data_sc.push(arr1[2]);
                    co2data_cm.push(arr2[2]);
                    luxdata_sc.push(arr1[4]);
                    luxdata_cm.push(arr2[4]);
                    soliddata_sc.push(arr1[5]);
                    soliddata_cm.push(arr2[5]);
                    time.push(result[i].time);
                    hour.push(result[i].hour);
                }
                echartsA.setOption(option);
            });
        }
        getData();

        $('#doing').click(function(){
            $('#flag').addClass('am-icon-calendar-plus-o');
            $('#flag').removeClass('am-icon-calendar-check-o');
        });
        $('#done').click(function(){
            $('#flag').removeClass('am-icon-calendar-plus-o');
            $('#flag').addClass('am-icon-calendar-check-o');
        });
        $('#index').addClass('active');
        var socket=io.connect('http://14961rg045.iask.in:35790');
        socket.on('info',function(data){
            //console.log(data);
            var arr=data.shucai;
            $('#temp').html(parseFloat(arr[0]).toFixed(2)+"°C");
            $('#wet').html(parseFloat(arr[1]).toFixed(1)+"%");
            $('#co2').html(parseFloat(arr[2]).toFixed(1)+"PPM");
            $('#ph').html(parseFloat(arr[3]).toFixed(1));
            $('#light').html(parseFloat(arr[4])+"Lux");
            $('#soild').html(parseFloat(arr[5]).toFixed(1)+"%");
            var arr1=data.caomei;
            $('#temp2').html(parseFloat(arr1[0]).toFixed(2)+"°C");
            $('#wet2').html(parseFloat(arr1[1]).toFixed(1)+"%");
            $('#co22').html(parseFloat(arr1[2]).toFixed(1)+"PPM");
            $('#ph2').html(parseFloat(arr1[3]).toFixed(1));
            $('#light2').html(parseFloat(arr1[4])+"Lux");
            $('#soild2').html(parseFloat(arr1[5]).toFixed(1)+"%");

        });
        socket.on('limit1',function(data){
            //console.log(data);
            var arr=data.split(',');
            $('#war-temp').html(parseFloat(arr[0])+"~"+parseFloat(arr[1])+"°C");
            $('#war-wet').html(parseFloat(arr[2])+"~"+parseFloat(arr[3])+"%");
            $('#war-co2').html(parseFloat(arr[4])+"~"+parseFloat(arr[5])+"PPM");
            $('#war-ph').html(parseFloat(arr[6])+"~"+parseFloat(arr[7]));
            $('#war-light').html(parseFloat(arr[8])+"~"+parseFloat(arr[9])+"Lux");
            $('#war-soild').html(parseFloat(arr[10])+"~"+parseFloat(arr[11])+"%");
        });
        socket.on('limit2',function(data){
            //console.log(data);
            var arr=data.split(',');
            $('#war-temp2').html(parseFloat(arr[0])+"~"+parseFloat(arr[1])+"℃");
            $('#war-wet2').html(parseFloat(arr[2])+"~"+parseFloat(arr[3])+"%");
            $('#war-co22').html(parseFloat(arr[4])+"~"+parseFloat(arr[5])+"PPM");
            $('#war-ph2').html(parseFloat(arr[6])+"~"+parseFloat(arr[7]));
            $('#war-light2').html(parseFloat(arr[8])+"~"+parseFloat(arr[9])+"Lux");
            $('#war-soild2').html(parseFloat(arr[10])+"~"+parseFloat(arr[11])+"%");
        });
        window.onbeforeunload = function(){
            socket.close();
        };
        function getNowFormatDate() {
            var date = new Date();
            var seperator1 = "-";
            var seperator2 = ":";
            var year = date.getFullYear();
            var month = date.getMonth() + 1;
            var strDate = date.getDate();
            if (month >= 1 && month <= 9) {
                month = "0" + month;
            }
            if (strDate >= 0 && strDate <= 9) {
                strDate = "0" + strDate;
            }
            var currentdate = year + seperator1 + month + seperator1 + strDate
                    + " " + date.getHours() + seperator2 + date.getMinutes()
                    + seperator2 + date.getSeconds();
            return currentdate;
        }

    </script>
</body>

</html>
